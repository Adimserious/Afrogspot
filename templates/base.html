{% load static %}

<!doctype html>
<html lang="en">

<head>

  {% block meta %}
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  {% endblock %}

  {% block extra_meta %}
  {% endblock %}

  {% block corecss %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato&display=swap">

  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  {% endblock %}

  {% block extra_css %}
  {% endblock %}

  {% block corejs %}
  <script src="https://kit.fontawesome.com/e9c73d7092.js" crossorigin="anonymous"></script>

  <script src="https://code.jquery.com/jquery-latest.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"></script>
  <!-- Stripe -->
  <script src="https://js.stripe.com/v3/"></script>
  {% endblock %}

  {% block extra_js %}
  {% endblock %}

  <title>Afrogspot {% block extra_title %}{% endblock %}</title>
</head>

<body>
  <header class="header">
    <!-- Bootstrap 5 Full-Width Header Template -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'home' %}">AfroGspot</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <!-- Search Form -->
          <form class="d-flex me-auto w-50" method="GET" action="{% url 'product_list' %}">
            <!-- Search input retains the previous search term -->
            <input class="form-control me-2 w-100" type="text" name="q" value="{{ query|default:'' }}"
              placeholder="Search for products, brands, and more..." aria-label="Search">
            <!-- Hidden input to retain the selected category when performing a search -->
            <input type="hidden" name="category" value="{{ category_name|default:'' }}">
            <button class="btn btn-outline-light" type="submit">Search</button>
          </form>

          <!-- Navigation Menu -->
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="{% url 'home' %}">Home</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="#">New Arrivals</a>
            </li>

            <!-- Categories Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                Categories
              </a>

              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <!-- Dynamically generated category links -->
                {% for category in categories %}
                <li>
                  <a class="dropdown-item" href="{% url 'product_list' %}?category={{ category.name|urlencode }}&q={{ query|urlencode }}">
                    {{ category.name }}
                  </a>
                </li>
                {% endfor %}
              </ul>
            </li>

            <!-- Account Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownAccount" role="button"
                data-bs-toggle="dropdown" aria-expanded="false">
                Account
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdownAccount">
                {% if request.user.is_authenticated %}
                  {% if request.user.is_superuser %}
                    <li><a class="dropdown-item" href="#">Manage Product</a></li>
                  {% endif %}
                  <li><a href="#" class="dropdown-item">My Profile</a></li>
                  <li><a href="{% url 'account_logout' %}" class="dropdown-item">Logout</a></li>
                {% else %}
                  <li><a class="dropdown-item" href="{% url 'account_login' %}">Login</a></li>
                  <li><a class="dropdown-item" href="{% url 'account_signup' %}">Register</a></li>
                {% endif %}
              </ul>
            </li>

            <!-- Cart Icon and Count -->
            <li class="nav-item">
              <a class="{% if grand_total %}text-primary font-weight-bold{% else %}text-white{% endif %} nav-link"
                href="{% url 'cart_detail' %}">
                <div class="text-center">
                  <i class="bi bi-cart"></i> ({{ product_count }})
                  <p class="my-0">
                    {% if grand_total %}
                      €{{ grand_total|floatformat:2 }}
                    {% else %}
                      €0.00
                    {% endif %}
                  </p>
                </div>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Delivery Banner -->
    <div id="delivery-banner" class="row text-center">
      <div class="col delivery-banner-child">
        <h4 class="my-1 text-primary">
          WE PREPARE A TABLE BEFORE YOU! <strong class="text-white">Free delivery on orders over €</strong>{{ free_delivery_threshold }}!
        </h4>
      </div>
    </div>

    <!-- Bootstrap Icons CDN for cart icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
  </header>

  {% block page_header %}
  {% endblock %}

  <main class="content">
    {% block content %}
    {% endblock content %}
  </main>

  <!-- Back to Top Button -->
  <a href="#" id="back-to-top" class="btn btn-success back-to-top" role="button">
    <i class="bi bi-arrow-up"></i>
  </a>

  <!-- Toast container for Django messages -->
  <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" data-autohide="false">
    {% if messages %}
      {% for message in messages %}
        <div class="toast align-items-center text-white bg-{{ message.tags }} border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">
          <div class="d-flex">
            <div class="toast-body">
              {{ message }}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <script>
    $(document).ready(function () {
      // Show or hide the button based on scroll position
      $(window).scroll(function () {
        if ($(this).scrollTop() > 100) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });

      // Smooth scroll to the top when the button is clicked
      $('#back-to-top').click(function (e) {
        e.preventDefault();
        $('html, body').animate({ scrollTop: 0 }, '300');
      });
    });
  </script>

  <!-- Custom Script to trigger toast -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var toastElList = [].slice.call(document.querySelectorAll('.toast'));
      var toastList = toastElList.map(function (toastEl) {
        return new bootstrap.Toast(toastEl).show();
      });
    });
  </script>


  <!--Code institute marketing wiskey footer-->
  <footer class="container-wrapper footer">
    <div class="container quotes-container content-container">
      <section class="footer">
        <div class="row">
          <div class="col-12 page-header mb-4">
            <h2 class="text-uppercase">Stay in touch:</h2>
            <hr class="block-divider block-divider--short">
          </div>
        </div>
        <div class="row">
          <div class="col-12 col-md-6">
            <h3>Social</h3>
            <p>Keep up to date with all our latest offers</p>
            <a href="#" target="_blank"><i class="fab fa-facebook-square"></i> Follow us on Facebook!</a>
          </div>
          <div class="col-12 col-md-6">
            <h2>Subscribe!</h2>
            <p>Get exclusive offers and discount codes by subscribing to our monthly newsletter</p>
            <!-- Mailchimp signup form here -->
          </div>
        </div>
      </section>
    </div>
  </footer>

</body>

</html>